# 서블릿

- - - - - - - - - - - - - - - - 
## reponse
1. out 갖고 있음(PrintWriter)
- 클라이언트로 출력하기 전에 charset set해야

## request
1. context맵, session맵 / parameter맵 갖고있음(HttpSession : 로그인정보 등이 들어있음)
- parameter 꺼내기전에 charset set해야


## context(Servlet들이 공통으로 써야할 '자원'들을 갖고 있다(정적자원, 동적자원))
- request나 sce가 갖고 있다(HttpServletRequest, ServletContextEvent)

1. 정적자원 - 웹 자원의 실제 경로 알아낼수있음(클라이언트에게 바이너리 데이터를 출력하든지하자)
ctx.getRealPath("/photo.jpeg") => 문자열 리턴 "C:\Users\bitcamp\eclipse-workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\bitcamp-web-project\photo.jpeg"

2. 동적자원 - context맵 - 우리는 일단 Service 넣었음()

- - - - - - - - - - - - - - - - 

## get vs post
- 멀티 선택에서 같은 name으로 여러개 넘어올때 어떻게 처리? => 나중에 배움

### get

- get은 파일명(문자열)은 보낼수있는데 파일 데이터(바이너리 데이터)는 못보낸다 => post를 써라

#### get요청을 보내는 3가지 경우
1. 웹 브라우저에 URL을 입력한 후 엔터를 치면 GET 요청을 보낸다.
2. 웹 페이지에서 [링크를 클릭]하면(자바스크립트 처리하지 않은 상태) GET 요청을 보낸다.
3. 웹 페이지의 폼(method='GET' 일 때)에서 전송 버튼을 클릭하면 GET 요청을 보낸다.


- - - - - - - - - - - - - - - -
## ex01 : 서블릿 만들기 : doGet, doPost 오버라이딩
셋 모두
Servlet 인터페이스를 구현해야되는데
MyServlet은 5개 메서드 전부 구현할 필요없어서
Generic Service 자바에서 만듬
근데 얘는 http 를 못다룸
그래서 또 얘를 상속하는 HttpServlet을 만듬
- - - - - - - - - - - - - - - -
## ex02 : 서블릿 컨테이너가 관리하는 컴포넌트 3가지 : Servlet, Listener, Filter
- - - - - - - - - - - - - - - -
## ex03 : 클라이언트(웹브라우저)로 [출력]하기
1. MIME-Type을 지정하고 출력해야함
[MIMETYPE 실수하면 다운로드 화면이 뜸]
예) 
res.setContentType("text/html;charset=UTF-8");
res.setContentType("image/jpeg");
2. 바이너리 데이터 출력하기
  - [ctx]로 실제 경로알아내서 출력함

- - - - - - - - - - - - - - - -
## ex04 : 클라이언트가 보낸 데이터 [읽기]
get요청, post요청 둘다 getParameter : 리턴은 무조건 문자열, utf-8 지정해야함

<!-- action을 지정하지않으면 [같은 url]로 이번에는 데이터를 붙여서 다시 요청 -->
- - - - - - - - - - - - - - - - 




## 포트번호 변경3가지 방법

1. C:\Users\bitcamp\server\apache-tomcat-9.0.40\conf\server.xml

<Connector port="9999" protocol="HTTP/1.1"
               connectionTimeout="20000"
               redirectPort="8443" />

2. 이클립스 프로젝트 익스플로러

3. Server view에서 더블클릭


## 절대 경로

[브라우저]
http://localhost:9999/eomcs-java-web/ex04/s1 => 걍 애노테이션
http://localhost:9999/eomcs-java-web/ex04/test01.html => 실제 위치

[서블릿에서]
/ => (정적파일) : context 루트 (예: /photo.jpeg => )
/ => (동적파일) : ?

[정적파일에서]
/ => (정적파일) : ?
/ => (동적파일) : 서버 루트 (예: /bitcamp-java-project/ex04/s1)


## url인코딩 - 면접 질문

url에는 특수문자나 공백이 들어갈 수 없다
특수문자나 공백이 들어가면 url 인코딩한다(공백은 +로 바뀜)
웹브라우저가 해준다
웹서버에서 디코딩해준다
서버에서 헷갈릴만한 문자는 웹브라우저가 인코딩하는거다
서버에서는 [req.getParmeter] 할때 url 디코딩 해줌



## 
```java
package com.eomcs.pms.web;

import java.io.IOException;
import java.io.PrintWriter;
import java.io.StringWriter;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import com.eomcs.pms.domain.Member;
import com.eomcs.pms.service.MemberService;

@WebServlet("/auth/login")
public class LoginServlet extends HttpServlet {

  private static final long serialVersionUID = 1L;


  /*
   * web app 한개당 context는 한개다 클라이언트마다 있는게 아님
   * 예) web apps 안에 app 6개 
   */
  @Override
  protected void doPost(HttpServletRequest request, HttpServletResponse response)
      throws ServletException, IOException {


    HttpSession session = request.getSession();


    request.setCharacterEncoding("UTF-8"); 
    /*
     * get요청은 안해도됨 post만 하면됨 (한글이 있다면). 특수문자는?
     */

    response.setContentType("text/html;charset=UTF-8");
    PrintWriter out = response.getWriter();

    // 클라이언트 전용 보관소를 준비한다

    out.println("<!DOCTYPE html>");
    out.println("<html>");
    out.println("<head><title>게시글조회</title></head>");
    out.println("<body>");

    try {
      out.println("<h1>로그인</h1>");

      if (session.getAttribute("loginUser") != null) {
        out.println("<p>로그인 되어 있습니다!</p>");
      } else {

        String email = request.getParameter("email");
        String password = request.getParameter("password");

        ServletContext ctx = request.getServletContext();
        MemberService memberService = (MemberService) ctx.getAttribute("memberService");

        Member member = memberService.get(email, password);
        if (member == null) {
          out.println("사용자 정보가 맞지 않습니다.");
        } else {
          // 로그인이 성공했으면 회원 정보를
          // 각 클라이언트의 전용 보관소인 session에 저장한다.
          session.setAttribute("loginUser", member);
          out.printf("<p>%s 님 반갑습니다.</p>", member.getName());
        }
      }
    } catch (Exception e) {
      out.println("<h2>작업 처리 중 오류 발생! - %s</h2>\n");
      out.printf("<pre>%s</pre>\n", e.getMessage());

      StringWriter errOut = new StringWriter();
      e.printStackTrace(new PrintWriter(errOut));
      out.println("<h3>작업 처리 중 오류 발생! - %s</h3>\n");
      out.printf("<pre>%s</pre>\n", errOut.toString());
    }

    out.println("</body>");
    out.println("</html>");
  }
}
```

```java
out.println("<form action='update' method='post'>");
      out.printf("번호: <input type='text' name='no' value='%d' readonly><br>\n", board.getNo());
      out.printf("제목: <input type='text' name='title' value='%s'><br>\n", board.getTitle());
      out.printf("내용: <textarea name='content'>%s</textarea><br>\n", board.getContent());
      out.printf("작성자: %s<br>\n", board.getWriter().getName());
      out.printf("등록일: %s<br>\n", board.getRegisteredDate());
      out.printf("조회수: %d<br>\n", board.getViewCount());
      out.println("<p>");
      out.println("<button>변경</button>");
      out.printf("<a href='delete?no=%d'>삭제</a>", board.getNo());
      /*
       * 삭제를 post방식으로 하려면 form을 새로 또 만들어야됨
       * 그래서 그냥 링크로 했음(get)
       */
      out.println("</p>");
      out.println("</form>");
```

